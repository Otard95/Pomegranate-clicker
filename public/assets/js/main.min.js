!function(){function e(){this.last=+new Date,this.delta=function(){var e=(+new Date-this.last)/1e3;return this.last=+new Date,e},this.since=function(e){return+new Date-e},this.now=function(){return+new Date}}var t=io();t.on("hasPlayer",function(e){console.log("[on.hasPlayer] status: "+e.status),e.status?(s.id=a.get("pId"),s.me=e.player,s.updateUI()):(s.preGame.show(),a.remove("pId"),e.err&&n.set(e.title,e.msg))}),t.on("userCreate",function(e){if(console.log("[userCreate] status: "+e.status),e.status){s.id=e.id,s.me=e.player;var t=new Date;t.setTime(t.getTime()+2592e6);var n="expires="+t.toUTCString();document.cookie="pId="+e.id+";"+n+";path=/",s.preGame.hide(),s.updateUI()}else e.err&&s.preGame.msg("bad",e.msg)}),t.on("buyUpgrade",function(e){console.log("[buyUpgrade] status: "+e.status),e.status&&(s.me=e.player,s.updateUI())}),t.on("click",function(e){s.me=e.player,s.updateSeeds()}),t.on("kick",function(e){n.set("You where kicked!",e.msg),t.disconnect()}),t.on("update",function(e){s.me=e.player});var s={id:null,me:{},clicks:0,clock:null,draw:null,time:new e,s:t,dom:{seeds:null,sps:null,pomegranate:null,updrades:{deseeder:{base:null,title:null,lvl:null,cost:null,buy:null},backyardShrub:{base:null,title:null,lvl:null,cost:null,buy:null},backyardTree:{base:null,title:null,lvl:null,cost:null,buy:null}}},preGame:null,updateSeeds:function(){this.dom.seeds.text(Math.floor(this.me.seeds+this.clicks))},updateSPS:function(){this.dom.sps.text(Math.round(this.me.sps))},updateUpgrades:function(){$.each(s.dom.updrades,function(e,t){t.title.text(s.me.upgrades[e].name),t.lvl.text(Math.round(s.me.upgrades[e].sps)),t.cost.text(Math.ceil(s.me.upgrades[e].cost))})},updateUI:function(){s.updateUpgrades(),s.updateSPS(),s.updateSeeds()},init:function(){console.log("init");var e=a.get("pId");void 0!==e?t.emit("hasPlayer",{id:e}):this.preGame.show(),s.dom.pomegranate.click(function(){s.clicks++,s.updateSeeds()}),$.each(s.dom.updrades,function(e,t){t.buy.click(function(){console.log(e),s.s.emit("buyUpgrade",{name:e})})}),s.clock=setInterval(function(){0!==s.clicks&&(s.s.emit("click",{n:s.clicks}),s.clicks=0),s.updateSeeds()},1e3),s.draw=setInterval(function(){s.me.seeds+=s.me.sps*s.time.delta(),s.updateSeeds()},1e3/30)}};s.preGame={base:null,msgBox:null,input:null,playBtn:null,show:function(){this.base.addClass("show")},hide:function(){this.base.removeClass("show")},msg:function(e,t){this.msgBox.html(t),this.msgBox.removeClass("good bad"),"good"==e?this.msgBox.addClass("good"):this.msgBox.addClass("bad"),this.msgBox.addClass("show")},msgHide:function(){this.msgBox.html(""),this.msgBox.removeClass("show good bad")}};var n={base:null,title:null,msg:null,closeBtn:null,set:function(e,t){this.title.html(e),this.msg.html(t),this.show()},show:function(){this.base.addClass("show")},hide:function(){this.base.removeClass("show")}};$(document).ready(function(){s.dom.seeds=$("#seedCounter"),s.dom.sps=$("#spsCounter"),$.each(s.dom.updrades,function(e,t){t.base=$("#"+e),t.title=t.base.find(".title"),t.lvl=t.base.find(".lvl"),t.cost=t.base.find(".cost"),t.buy=t.base.find(".buyBtn")}),s.dom.pomegranate=$("#pomegranate"),s.preGame.base=$(".preGame"),s.preGame.msgBox=$(".preGame > .menuBox > .msgBox"),s.preGame.input=$("#pNameIn"),s.preGame.playBtn=$("#playBtn"),s.preGame.playBtn.click(function(){t.emit("userCreate",{name:s.preGame.input.val()})}),n.base=$(".overlay"),n.title=n.base.find(".title"),n.msg=n.base.find(".msg"),n.closeBtn=n.base.find(".closeBtn"),n.base.click(function(e){e.target==this&&n.hide()}),n.closeBtn.click(function(){n.hide()}),s.init()});var a={get:function(e){var t=document.cookie.replace(/ /g,""),s=t.split(";"),n={};for(var a in s){var l=s[a].split("=");n[l[0]]=l[1]}return n[e]},remove:function(e){document.cookie="pId=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/;"}}}();