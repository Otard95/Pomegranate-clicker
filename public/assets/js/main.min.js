!function(){function e(e){var s=document.cookie.replace(/ /g,""),t=s.split(";"),l={};for(var a in t){var n=t[a].split("=");l[n[0]]=n[1]}return l[e]}var s=io();s.on("hasPlayer",function(s){console.log("[on.hasPlayer] status: "+s.status),s.status?(t.id=e("pId"),t.me=s.player,t.updateSeeds(),t.updateUpgrades()):(t.preGame.show(),s.err&&l.set(s.title,s.msg))}),s.on("userCreate",function(e){if(console.log("[userCreate] status: "+e.status),e.status){t.id=e.id,t.me=e.player;var s=new Date;s.setTime(s.getTime()+2592e6);var l="expires="+s.toUTCString();document.cookie="pId="+e.id+";"+l+";path=/",t.preGame.hide(),t.updateUpgrades()}else e.err&&t.preGame.msg("bad",e.msg)}),s.on("buyUpgrade",function(e){console.log("[buyUpgrade] status: "+e.status),e.status&&(t.me=e.player,t.updateUpgrades(),t.updateSPS(),t.updateSeeds())}),s.on("click",function(e){t.me=e.player,t.updateSeeds()}),s.on("kick",function(e){l.set("You where kicked!",e.msg),s.disconnect()}),s.on("update",function(e){t.me=e.player});var t={id:null,me:{},clicks:0,clock:null,s:s,dom:{seeds:null,sps:null,pomegranate:null,updrades:{deseeder:{base:null,title:null,lvl:null,cost:null,buy:null},backyardShrub:{base:null,title:null,lvl:null,cost:null,buy:null},backyardTree:{base:null,title:null,lvl:null,cost:null,buy:null}}},preGame:null,updateSeeds:function(){this.dom.seeds.text(Math.floor(this.me.seeds+this.clicks))},updateSPS:function(){this.dom.sps.text(Math.round(this.me.sps))},updateUpgrades:function(){console.log("updateUpgrades"),$.each(t.dom.updrades,function(e,s){console.log(e),console.log(s),s.title.text(t.me.upgrades[e].name),s.lvl.text(Math.round(t.me.upgrades[e].sps)),s.cost.text(Math.ceil(t.me.upgrades[e].cost))})},init:function(){console.log("init");var l=e("pId");void 0!==l?s.emit("hasPlayer",{id:l}):this.preGame.show(),t.dom.pomegranate.click(function(){t.clicks++,t.updateSeeds()}),$.each(t.dom.updrades,function(e,s){s.buy.click(function(){console.log(e),t.s.emit("buyUpgrade",{name:e})})}),t.clock=setInterval(function(){0!==t.clicks&&(t.s.emit("click",{n:t.clicks}),t.clicks=0),t.updateSeeds()},1e3)}};t.preGame={base:null,msgBox:null,input:null,playBtn:null,show:function(){this.base.addClass("show")},hide:function(){this.base.removeClass("show")},msg:function(e,s){this.msgBox.html(s),this.msgBox.removeClass("good bad"),"good"==e?this.msgBox.addClass("good"):this.msgBox.addClass("bad"),this.msgBox.addClass("show")},msgHide:function(){this.msgBox.html(""),this.msgBox.removeClass("show good bad")}};var l={base:null,title:null,msg:null,closeBtn:null,set:function(e,s){this.title.html(e),this.msg.html(s),this.show()},show:function(){this.base.addClass("show")},hide:function(){this.base.removeClass("show")}};$(document).ready(function(){t.dom.seeds=$("#seedCounter"),t.dom.sps=$("#spsCounter"),$.each(t.dom.updrades,function(e,s){s.base=$("#"+e),s.title=s.base.find(".title"),s.lvl=s.base.find(".lvl"),s.cost=s.base.find(".cost"),s.buy=s.base.find(".buyBtn")}),t.dom.pomegranate=$("#pomegranate"),t.preGame.base=$(".preGame"),t.preGame.msgBox=$(".preGame > .menuBox > .msgBox"),t.preGame.input=$("#pNameIn"),t.preGame.playBtn=$("#playBtn"),t.preGame.playBtn.click(function(){s.emit("userCreate",{name:t.preGame.input.val()})}),l.base=$(".overlay"),l.title=l.base.find(".title"),l.msg=l.base.find(".msg"),l.closeBtn=l.base.find(".closeBtn"),l.base.click(function(e){e.target==this&&l.hide()}),l.closeBtn.click(function(){l.hide()}),t.init()})}();